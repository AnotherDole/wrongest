<!DOCTYPE html>
<html>
Name: <input type="text" id='usernameinput' maxlength="15"> <button onclick="sendusername();">Send Username</button>
<div id="logonresult">No result yet.</div>
<br>

<select id='roomselector'>
</select>

<input type="text" id='roomnamer' maxlength="15">
<button id='createroombutton' onclick='createroom();'>Create New Room</button>
<button id='joinroombutton' onclick='joinroom();'>Join Selected Room</button>
<button id='updaterooms' onclick='updaterooms();'>Update Room Selection</button>
<button id='leaveroom' onclick='leaveroom();'>Leave Current Room</button>
<div id='roomresult'>No result yet.</div>
<div id='roommembers'>Not in a room yet.</div>

<br><br>

<button id='startgamebutton' onclick='startgame();'>Start Game</button>
<div id='startresult'></div>

<h1>Defend this Statement:</h1>
<h2 id='statement'></h2>
<br>
<h1>Other players</h1>
<div id='playerstatement1'></div>
<div id='playerstatement2'></div>
<div id='playerstatement3'></div>
<div id='playerstatement4'></div>
<br>
<button onclick='donedefend();'>I am done defending my point.</button>
<div id='votestatus'>It is not time to vote yet.</div>
Least Wrong: <input id='least' type='number' min='1' max='8' value='1'> Most Wrong: <input id='most' type='number' min='1' max='8' value='1'>
<button onclick='sendvotes();'>Send my votes.</button>
<div id='voteresult'></div>

<script src="https://cdn.socket.io/socket.io-1.2.1.js"></script>
<script src="http://code.jquery.com/jquery-2.0.3.min.js"></script>
<script>
var socket = io('');
var username = "";

//send username string
function sendusername(){
	socket.emit('logon', $('#usernameinput').val());
}

//received after emitting logon
socket.on('logonresult',function(data){
	if(data.success){
		$('#logonresult').text('Success!');
		username = data.name;
		updaterooms();
	}
	else{
		$('#logonresult').text(data.message);
	}
});

//send roomname string
function createroom(){
	socket.emit('createroom',$('#roomnamer').val());
}

//received after emitting createroom
socket.on('createresult',function(data){
	if(data.success){
		$('#roomresult').text('Room created!');
	}
	else{
		$('#roomresult').text(data.message);
	}	
});

//Send request for information about all rooms
function updaterooms(){
	socket.emit('requestroomdata');
}

//recieved after emitting request for name and player count of all rooms
socket.on('roomdata',function(data){
	$('#roomselector').empty();
	for(room in data){
		var name = data[room].name;
		var toAppend = '<option value="'+name+ '">' + name + ' (' + data[room].playerCount;
		toAppend = toAppend +'/8) </option>';
		$('#roomselector').append(toAppend);
	}
});


//send name of room to join
function joinroom(){
	socket.emit('requestjoin',$('#roomselector').val());
}

//received after emitting requestjoin
socket.on('joinresult',function(data){
	if(data.success){
		$('#roomresult').text('Successfully joined room');
	}
	else{
		$('#roomresult').text(data.message);
	}
});

//send request to leave current room. 
function leaveroom(){
	socket.emit('requestleave');
}	

//received after leaving a room
socket.on('leaveresult',function(data){
	if(data.success){
		$('#roommembers').empty();
		$('#roommembers').text('Not in a room yet');
	}	
});

//received whenever someone in the current room leaves or joins
socket.on('updatecurrentroom', function(data){
	var $toChange = $('#roommembers');
	$toChange.empty();

	$toChange.append('Currently in ' + data.roomName + ':<br>');
	for (var i = 0; i < data.players.length; i++){
		$toChange.append(data.players[i]);
		if(data.players[i] == data.leader){
			$toChange.append(" (leader)");
		}
		$toChange.append("<br>");
	}
});

//Request to start the game. Only works if you are the leader of the room
function startgame(){
	socket.emit('requeststart');
}

socket.on('startresult', function(data){
	if(data.success){
		$('#startresult').text('Game Started');		
	}
	else{
		$('#startresult').text(data.message);
	}
});

//Receive the statments that everyone will be defending this round.
//Automatically sent out at the start of a new round
socket.on('getstatements', function(data){	
	for(var player in data){
		var playerNum = data[player].playerNum;
		var quote = data[player].quote;
		var author = data[player].author;
		var episode = data[player].episode;
		var score = data[player].score;
		if(player == username){
			$('#statement').empty().append(quote);
		}
		else{
			var $thediv = $('#playerstatement'+playerNum);
			$thediv.empty();
			$thediv.append(playerNum + " " + player + ": " + quote);
		}
	}	
});

//Tell server you are done defending your statement
function donedefend(){
	socket.emit('donedefending');
}

//received when anyone in the room says they are done defending
//data is the # of people who are not done
socket.on('newdefendcount',function(data){
	if(data >0){
		$('#votestatus').text('Dones needed to continue:' + data);	
	}
	else{
		$('#votestatus').text('Time to vote!');
	}
});

//received if your attempt to say you are done voting failed for some reason
socket.on('donefailed',function(data){
	$('#votestatus').text(data);
});

//send votes for most/least wrong
//most and least should be the ID of the player
function sendvotes(){
	var mostWrong = $('#most').val();
	var leastWrong = $('#least').val();
	socket.emit('playervotes',{most: mostWrong, least: leastWrong});
}

//received if the submitted votes were invalid
socket.on('votefailed', function(data){
	$('#voteresult').append(data + "<br>");	
});

//received when someone else in the same room has voted
socket.on('receivevote', function(data){
	var whoVoted = data.voter;
	var mostPlayerNum = data.mostNum;
	var mostPlayerName = data.mostName;
	var leastPlayerNum = data.leastNum;
	var leastPlayerName = data.leastName;
	$('#voteresult').append(whoVoted + " says that " + leastPlayerName + " is least wrong and " + mostPlayerName + " is most wrong.<br>");
});
</script>
</html>
